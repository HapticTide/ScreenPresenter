# Changelog

## 1.0.4

### 新功能

- **Markdown 编辑器会话体验增强**
  - 当仅有一个空白未改动文档时，打开文件会复用该标签页，而不是新增标签页
  - 启动应用时自动恢复上次打开的 Markdown 文件（支持多文件，自动跳过不存在文件）
  - 标签页新增未保存状态标记（`*`），覆盖“新建未保存”与“已落盘但有改动未保存”两种情况

- **退出流程重构（按投屏状态）**
  - 无设备正在投屏时，`⌘Q` 直接退出
  - 有设备正在投屏时，显示二次确认弹窗；弹窗展示 App 图标与退出影响说明
  - 弹窗显示期间再次按 `⌘Q` 可直接退出
  - 新增对未保存文档的分流处理：未落盘文档优先触发保存；已落盘未保存文档先自动保存再继续退出流程

- **主菜单结构优化**
  - 移除“编辑”菜单
  - 合并“设备”与“显示”为“捕获”菜单
  - 菜单顺序调整为：`文档编辑器 | 捕获 | 窗口 | 帮助`
  - “帮助”菜单新增“GitHub 主页”“反馈问题（Issues）”入口

### 改进

- **音频设置与显示一致性**
  - iOS/Android 音频捕获默认关闭
  - `DeviceCaptureInfoView` 在音频捕获关闭时隐藏全部音频相关 UI
  - 音频捕获开关改为“重启 App 后生效”的会话级行为，避免运行中状态不一致
  - 偏好设置音频分组新增黄色提示：音频捕获开关需重启 App 生效

## 1.0.3

### 新功能

- **内嵌 Markdown 编辑器**
  - 多标签页支持，可同时编辑多个文档
  - 语法高亮，支持 10+ 代码主题（GitHub Light/Dark、Xcode、Dracula、Cobalt 等）
  - 查找与替换（⌘F / ⌘⇧F）
  - 格式快捷工具栏（标题、粗体、斜体、链接、代码等）
  - 文件操作：新建、打开、保存、另存为，支持最近文件列表
  - 编辑器位置可配置（左侧 / 右侧 / 居中），在偏好设置或 Markdown 菜单中切换
  - 编辑器缩放（⌘+ / ⌘-）
  - 编辑器主题独立于主窗口外观，不影响应用整体样式
  - 支持 .md / .markdown / .txt 文件类型

- **标准编辑菜单**
  - 新增编辑菜单，包含撤销、重做、剪切、复制、粘贴、全选
  - 查找子菜单：查找与替换、查找下一个/上一个、用所选内容查找

- **退出确认**
  - 关闭应用时弹出确认对话框，防止误操作
  - 若编辑器有未保存文档，优先提示保存

### 修复

- **VideoToolbox 解码器线程安全**：修复 `Unmanaged` 引用跨 Dispatch 队列传递时的潜在崩溃问题

### 改进

- 布局模式偏好设置变更时工具栏状态自动同步
- 新增 Markdown 编辑器可见性和位置变更的通知机制

### 其他

- 新增 AGENTS.md 开发指南
- 新增 .swiftformat 代码格式配置
- 移除过时的审计报告和技术文档
